---
layout: post
title: "Recreating Photoshop Drop Shadows in CSS3 and Compass"
date: 2011-06-21 13:10
comments: true
categories: compass sass css
---
<p>A challenge all web developers face is converting Photoshop documents into real, functioning web pages. Often this is a simple matter of measuring things and picking colors but in the case of drop shadows, recreating them in CSS3 can be challenging. For some reason I have yet to find a tool that will simply translate the settings from the Photoshop Layer Style Drop Shadow dialog into proper CSS3 &mdash; so I decided to create on in Compass. I created a Sass <code>@mixin</code> that relies on Compass to easily create CSS3 <code>box-shadow</code>s from the values found in Photoshop.</p>

<h2>Photoshop Layer Style Drop Shadow Dialog</h2>
<figure>
<img src="http://www.zetaprints.com/help/wp-content/uploads/2009/12/photoshop_drop_shadow_settings1.png" alt="Photoshop Layer Style Drop Shadow Dialog">
<figcaption>Photoshop Drop Shadow Dialog (<a href="http://www.google.com/search?q=photoshop+drop+shadow+dialog&tbm=isch&biw=1293&bih=1255">Internet</a>)</figcaption>
</figure>
<p>Above you can see the Drop Shadow dialog in Photoshop. There is an article online that does a great job of breaking down <a href="http://garymgordon.com/misc/tutorials/photoshop_tutorial/effects1/dropshadow.htm">what each of the properties do</a>. Once it's understood what Photoshop is using to calculate it's easy to translate those values into <a href="https://developer.mozilla.org/en/css/box-shadow">CSS3 <code>box-shadow</code> values</a></p>
<dl>
	<dt>Blend Mode:</dt>
	<dd>CSS does not offer a similar property, this makes it difficult to easily match the colors. CSS can only do the Normal blending mode, however Photoshop uses Multiply by default.</dd>

	<dt>Opacity:</dt>
	<dd>Sets the opacity of the shadow. This is similar to using <code>rgba()</code>. <em>Note: <code>rgba()</code> is currently <a href="http://css3pie.com/documentation/supported-css3-features/#rgba">not supported in CSS3PIE</a> for <code>box-shadow</code></em>.</dd>

	<dt>Angle:</dt>
	<dd>The angle can be replicated using the <code>&lt;offset-x&gt;</code> and <code>&lt;offset-y&gt;</code> values of <code>box-shadow</code> and can be calculated with a little trigonometry.</dd>

	<dt>Distance:</dt>
	<dd>Sets the distance from the shadow to the box. This combines with the Angle for calculating the <code>&lt;offset-x&gt;</code> and <code>&lt;offset-y&gt;</code>.</dd>

	<dt>Spread:</dt>
	<dd>Determines the portion of the shadow (determined by the size property) that is a solid color; the rest of the shadow is blurred. Spread is the same as the <code>&lt;spread-radius&gt;</code> of <code>box-shadow</code>.</dd>

	<dt>Size:</dt>
	<dd>Sets the size of the shadow. In CSS3 the size is the <code>&lt;blur-radius&gt;</code> plus the <code>&lt;spread-radius&gt;</code> of <code>box-shadow</code>.</dd>

	<dt>Contour &amp; Noise:</dt>
	<dd>CSS3 <code>box-shadow</code> has no equivalent values.</dd>
</dl>

<h2>CSS3 Box Shadow</h2>
<p>Now that we have a basic understanding of what Photoshop is doing, let's look at the values that <code>box-shadow</code> accepts and see how they compare.</p>
<dl>
	<dt><code>&lt;offset-x&gt;</code> and <code>&lt;offset-y&gt;</code>:</dt>
	<dd>Moves the shadow on the x an y axis. These values are required and are always the first two length properties. These are calculated using the angle and distance in Photoshop.</dd>

	<dt><code>&lt;blur-radius&gt;</code></dt>
	<dd>The radius of the blur in addition to the spread. A blur of 10px with a spread of 10px will result in a 20px shadow where the first 10 pixels (the spread) is solid and the last 10 pixels gradually fade out (the blur). This is always the third length value and is optional.</dd>

	<dt><code>&lt;spread-radius&gt;</code></dt>
	<dd>Just like Photoshop, the spread is the portion of the shadow that is a solid color. Unlike Photoshop, spread is expressed in pixels instead of as a percentage of the total size. A spread of 10px with a 0px blur will look similar to a 10px solid border. Spread is always the fourth length value and is optional.</dd>

	<dt><code>&lt;color&gt;</code></dt>
	<dd>Sets the color of the shadow. If a blur is set the shadow will automatically be slightly transparent. The spread area of the shadow will appear in the color specified. To have the entire shadow, including spread, appear transparent use <code><a href="https://developer.mozilla.org/en/CSS/color_value#section_9">rgba()</a></code>.</dd>
</dl>
<h2>Generating the CSS3 Values from the Photoshop Values</h2>
<p>As mentioned before, although Photoshop and CS3 represent the values differently, they are actually analogous to each other. Below is a Sass <code>@mixin</code> that takes values from Photoshop, converts them, and creates a CSS3 <code>box-shadow</code>.</p>
{% gist 1039282 photoshop-drop-shadow.scss %}
<p>The code above relies on the <a href="http://compass-style.org/reference/compass/css3/box_shadow/#mixin-box-shadow">Compass <code>box-shadow()</code></a> <code>@mixin</code> to generate the correct CSS rules with all of the various vendor prefixes.</p>
<h3>Calculating the Offsets</h3>
<p>Although Photoshop uses angle and distance, this is exactly the same as x and y offset. Imagine a right triangle where the <code>&lt;offset-x&gt;</code> and the <code>&lt;offset-y&gt;</code> formed the right angle. The distance would be the hypotenuse and the angle is the inner angle. There are <a href="http://easycalculation.com/trigonometry/triangle-angles.php">online triangle calculators</a> for this basic trigonometry. Again, the y-offset and the x-offset are the opposite and adjacent sides, the distance is the hypotenuse.</p>
<figure>
<svg xmlns="http://www.w3.org/2000/svg" width="210" height="210">
  <line x1="20" x2="20" y1="10" y2="190" stroke="red" fill="transparent" stroke-width="3"/>
  <line x1="20" x2="200" y1="190" y2="190" stroke="green" fill="transparent" stroke-width="3"/>
  <line x1="200" x2="20" y1="190" y2="10" stroke="black" fill="transparent" stroke-width="3"/>
  <!-- circle cx="200" cy="190" r="30" stroke="red" fill="transparent" stroke-width="3"/ /> -->
  <path d="M 170 190 A 30 30, 0, 0, 1, 178.6 168.6" stroke="gray" fill="transparent" stroke-width="2"/>
  <text x="75" y="205" fill="green">x-offset</text>
  <text x="-135" y="13" fill="red" transform="rotate(270)">y-offset</text>
  <text x="30" y="-11" fill="black" transform="translate(60,60) rotate(45) translate(0,0)">distance</text>
  <text x="185" y="112" fill="gray" transform="rotate(20)">angle</text>
</svg>
<figcaption>Triangle formed by x-offset, y-offset, distance and angle. (<a href="http://caniuse.com/#feat=svg-html5">requires modern browser</a>)</figcaption>
</figure>
<p>Using this basic understanding of triangles it becomes easy to calculate the offsets using to Photoshop Drop Shadow values. As the online triangle calculator above points out, <code>Sin(&Theta;) = Opposite / Hypotenuse</code>. More importantly, <code>Opposite = Sin(&Theta;) * Hypotenuse</code>. The same is true of the adjacent side: <code>Adjacent = Cos(&Theta;) * Hypotenuse</code>. And if you're remembering your trig properly &mdash; or looking at the <a href="http://easycalculation.com/trigonometry/triangle-angles.php">cheat sheet</a> &mdash; you know that only two values are needed to calculate any other two. It's a good thing that I requested the <a href="https://github.com/chriseppstein/compass/issues/201">basic trig functions be added to compass</a>, otherwise this wouldn't be possible.</p>
<p>For those who are still totally lost:</p>
<ul>
	<li>Angle == &Theta;</li>
	<li>Distance == Hypotenuse;</li>
	<li>y-offset == Opposite;</li>
	<li>x-offset == Adjacent;</li>
</ul>
<h3>Calculating the Blur and Spread</h3>
<p> The CSS Blur and Spread are not quite as straight-forward but are equally easy to calculate. In Photoshop, the size attribute represents the total size of the shadow and the spread represents the percentage of that distance that is blurred. In CSS those properties are additive &mdash; the spread is the size of the shadow that is solid and the blur is the portion that is blurred. With this in mind, CSS Blur is equal to the Photoshop size minus the CSS spread and the CSS spread equals the Photoshop size multiplied by the Photoshop spread percentage. Again, the code example above bears this out.</p>
<h2>Seeing This in Action</h2>
<p>The SASS file above makes it much easier to support IE</p>
{% gist 1039282 example.scss %}
{% gist 1039282 example.css %}