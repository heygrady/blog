---
layout: post
title: "Using Images and JavaScript and Compass for Easy Cross-Browser Rounded Corners"
date: 2011-08-25 13:14
comments: true
categories: js sass compass polyfill plug-in
---
<p>In a previous <a href="{% post_url 2011-02-24-cross-browser-rounded-corners-overview %}">post exploring rounded corner methods</a>, I covered a technique using absolute positioning for faking rounded corners in browsers greater than IE6. One issue with faking rounded corners is the amount of HTML markup required as well as the hassle of crafting the accompanying CSS. I have created a jQuery plug-in for adding the required markup and a complementary Sass/Compass @mixin for generating the required CSS. The markup generated utilizes jQuery UI theming for the CSS class names. The code is <a href="https://github.com/heygrady/corners" title="jQuery corners">available on GitHub</a></p>
<!--more-->
{% h2 Summary of the Technique %}
<p><a href="{% post_url 2011-02-24-cross-browser-rounded-corners-overview %}#using-absolute-positioning">As covered before</a>, the idea is to use extra markup and CSS to create rounded corners even without support for <code>border-radius</code>. Of course the technique is also useful for creating fancy corners that <code>border-radius</code> wouldn't support. The two examples below show a normal <code>div</code> using <code>border-radius</code> and a box that is using the absolutely positioned <code>span</code> technique from the previous article.</p>
<figure>
	<img id="fig-border-radius-image" src="http://assets.heygrady.com/corners/border-radius-box.png" alt="simple box with a red border" />
	<iframe id="fig-border-radius-iframe" width="202" height="202" scrolling="no" frameborder="0" src="http://assets.heygrady.com/corners/border-radius-box.html"></iframe>
	<script>
		if (Modernizr.borderradius) {
			document.getElementById("fig-border-radius-image").style.display = "none";
		} else {
			document.getElementById("fig-border-radius-iframe").style.display = "none";
		}
	</script>
	<figcaption>Border Radius<br>(<a href="http://assets.heygrady.com/corners/border-radius-box.html" target="_blank">view live example</a>)</figcaption>
</figure>
<figure>
	<iframe width="202" height="202" scrolling="no" frameborder="0" src="http://assets.heygrady.com/corners/position-box-sprite.html"></iframe>
	<figcaption>Absolute Position using a Sprite<br>(<a href="http://assets.heygrady.com/corners/position-box-sprite.html" target="_blank">view live example</a>)</figcaption>
</figure>
{% h3 Basic Markup %}
<p>The absolute positioning technique requires some additional markup to be added to the page for the corners and sides of the box. Below the initial <code>.box</code> is shown with no additional markup.</p>
{% gist 1161561 box.html %}
<p>In order to create the illusion of corners, some additional markup must be added to the page. First the content is wrapped in a <code>.ui-corners-content</code> that is used with <code>z-index</code> to <a href="http://jsfiddle.net/heygrady/3YbNk/">ensure that the corners never cover up the content</a> of our <code>.box</code> &mdash; <a href="http://www.w3.org/TR/css3-background/#corner-clipping"
><code>border-radius</code> doesn't clip content</a> unless <code>overflow: hidden;</code> is set. Next, eight <code>span</code>s are added; one for each corner and side. Below is the markup used for creating the rounded corner illusion.</p>
{% gist 1161561 corners.html %}
<p>As you can see above, the extra markup is very straightforward but it's not exactly ideal to have to add this to every box on a website &mdash; this is the point of the jQuery plug-in that will be discussed further down.</p>
{% h3 Basic CSS %}
<p>In order to optimize performance and simplify the JavaScript plug-in, all of the styling is done using CSS. The base CSS will set the <code>z-index</code> of the <code>.ui-corners-content</code> and position each of the corners and sides. As mentioned in the previous article, conflicting positioning properties are used to ensure that the sides stretch the fill width of the <code>.box</code>. For instance the left side, <code>.ui-corners-side-left</code>, is given a <code>top</code> and a <code>bottom</code> of 10px. Setting the <code>top</code> and <code>bottom</code> at the same time has the effect of stretching the <code>span</code> the entire height because both properties are honored. The 10px spacing is to prevent the sides from overlapping the corners. As mentioned in the previous article, IE6 will ignore the conflicting properties which makes this a poor solution for sites that require IE6 support.</p>
<p>The CSS below will correctly position all of the <code>span</code>s and set some default heights and widths. In order to actually see something, the base CSS needs to be extended by adding background images and altering the default heights and widths &mdash; this is the point of the Compass <code>@mixin</code> that will be discussed further down.</p>
{% gist 1161561 base.css %}
<p>Although absolutely positioned background images can look like a native <code>border-radius</code>, they don't actually affect the sizing of the box like a real border does. It's easy to fake the presence of a border by adding <code>padding</code> to the <code>.box</code> equal to the width of the border. While it's possible to simply set a transparent border &mdash; <code>border: 10px solid transparent;</code> &mdash; setting a border will require additional calculations for the corner and side <code>span</code>s because <a href="http://jsfiddle.net/heygrady/HVNEJ/">border appears outside the box</a>.</p>
{% h2 Using the jQuery Corners Plug-in %}
<p>The jQuery Corners plug-in is very straightforward. Exactly as described in the basic markup section above, it wraps the content of the container in a <code>div</code> and adds eight <code>span</code>s to the container. Again, starting with the basic box.html file in the basic markup section above, the additional markup can be added as shown below.</p>
{% gist 1161561 usage.js %}
<p>Currently the plug-in takes no arguments and does not apply any styling to the page. This is intentional because the styling should be controlled using CSS, similar to most jQuery UI widgets.</p>
{% h3 The Actual Plug-In %}
<p>Below is the actual plug-in that adds the markup to the page. As noted above, the plug-in wraps the contents of the target element in a <code>.ui-corners-content</code> and then appends all of the side and corner <code>span</code>s.</p>
{% gist 1161561 jquery-corners.js %}
<p>Special care is taken to avoid adding the extra markup to elements that have already been processed. The <code>.ui-corners</code> class is detected and those elements are skipped. Also, repeated strings are saved in variables to <a href="http://yuiblog.com/blog/2008/02/11/helping-the-yui-compressor">aid in compressing</a>. The script is only 402 characters after running it through <a href="http://www.refresh-sf.com/yui/">YUI Compressor</a> and 267 bytes after gzipping.</p>
{% h3 Seeing the Plug-in In Action %}
<p>Below you can see a <code>.box</code> that has had the corners applied. The base.css file shown above is used for the styling. Background colors have been applied to the side and corner <code>span</code>s to make them visible. It's also clear that the corners and sides are not overlapping the content.</p>
<figure>
	<iframe width="202" height="202" scrolling="no" frameborder="0" src="http://assets.heygrady.com/corners-2/base.html"></iframe>
	<figcaption>jQuery Corners Basic Usage<br>(<a href="http://assets.heygrady.com/corners-2/base.html" target="_blank">view live example</a>)</figcaption>
</figure>
<p>For more advanced styling it is recommended to use the SASS <code>@mixin</code> described below.</p>
{% h2 Using the UI Corners <code>@mixin</code> %}
<p>Although the base.css above will correctly position all of the corners and sides, more calculations are needed for actually using background images. For these purposes the SASS/Compass plug-in provides two <code>@mixin</code>s: <code>corner-images</code> and <code>corner-border-width</code>. These <code>@mixin</code>s greatly simplify the creation of CSS for mimicking rounded corners as well as more advanced examples.</p>
{% h4  Using @mixin corner-images %}
<p>The <code>corner-images</code> <code>@mixin</code> takes eight arguments, one for each corner and side. The arguments are ordered clockwise starting with the top-left corner and ending with the left side. Each argument is a <a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#lists">Sass list</a> of values. The corners and sides require slightly different values in the list &mdash; corners have a height and width while sides only have one dimension that can be specified &mdash; however <code>background-image</code> value is always the first value. All other values in the list can be left at default. Each argument is optional and may be skipped by passing in "auto" or using <a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#keyword_arguments">Sass keyword arguments</a>.</p>
<h5><code>@include corner-images( [$tl], [$t], [$tr], [$r], [$br], [$b], [$bl], [$l] )</code></h5>
<ul>
	<li><code>$tl</code> &mdash; [background-image] [width] [height] [background-position-x] [background-position-y] [left] [top] </li>
	<li><code>$t</code> &mdash; [background-image] [height] [background-position-x] [background-position-y] [top] [left] [right]</li>
	<li><code>$tr</code> &mdash; [background-image] [width] [height] [background-position-x] [background-position-y] [right] [top]</li>
	<li><code>$r</code> &mdash; [background-image] [width] [background-position-x] [background-position-y] [right] [top] [bottom]</li>
	<li><code>$br</code> &mdash; [background-image] [width] [height] [background-position-x] [background-position-y] [right] [bottom]</li>
	<li><code>$b</code> &mdash; [background-image] [height] [background-position-x] [background-position-y] [bottom] [left] [right]</li>
	<li><code>$bl</code> &mdash; [background-image] [width] [height] [background-position-x] [background-position-y] [left] [bottom]</li>
	<li><code>$l</code> &mdash; [background-image] [width] [background-position-x] [background-position-y] [left] [top] [bottom]</li>
</ul>
{% h4 Using @mixin corner-border-width %}
<p>The <code>corner-border-width</code> <code>@mixin</code> mimics a real border on the <code>box</code> using padding. As discussed above, setting a transparent border will cause some positioning issues because <a href="http://jsfiddle.net/heygrady/HVNEJ/">borders appears outside of the element</a>. This issues is overcome by simply using <code>padding</code>. For convenience, if real padding is needed it can be passed as the second argument which will be added to the first argument. Both arguments are <a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#lists">Sass lists</a> taking the same values as the <a href="http://reference.sitepoint.com/css/padding">CSS padding property</a>. Similar to <code>padding</code>, each argument can take a list of one, two, three or four values.</p>
<h5><code>@include corner-border-width( $border-width, [$padding] )</code></h5>
<ul>
	<li><code>$border-width</code> &mdash; [top-width] [right-width] [bottom-width] [left-width]</li>
	<li><code>$padding</code> &mdash; [top-width] [right-width] [bottom-width] [left-width]</li>
</ul>
{% h3 The Actual @mixin %}
<p>Below is the entire <code>@mixin</code> that is used for generating the CSS. There are the two mixins mentioned above as well as a number of helper functions for manipulation all of the list values. Close inspection reveals that there are a number over default variables available. Passing "default" instead of "auto" for any value will favor the default value if it exists. Auto values are based on the other passed values while default values rely blindly on the default variables. The <a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#variable_defaults_">default variables can be easily overridden</a>. At the bottom of the file, the default styles are visible. Simply including this plugin will generate the default styles as shown in the base.css above.</p>
{% gist 1161561 _ui-corners.scss %}
{% h2 Basic Fake <code>border-radius</code> Example %}
<p>In order to mimic <code>border-radius</code> we'll need some images. For this example we'll use eight separate images as described in the <a href="{% post_url 2011-02-24-cross-browser-rounded-corners-overview %}#background-images">previous article</a>. Using the <code>@mixin</code> this becomes very simple as shown below.</p>
{% gist 1161561 box.scss %}
<p>Above is a <code>.box</code> where an image is used for each corner and side. The <code>.box</code> also has a <code>border-width</code> of 1px and <code>padding</code> of 10px. Below is the CSS code that is generated. Only the code that is distinct form the basic CSS is generated. The "?1313871969" after the images is a cache busting artifact caused by the <code>@mixin</code>s reliance on <a href="http://compass-style.org/reference/compass/helpers/urls/#image-url">Compass's <code>image-url</code> <code>@function</code></a> and can be turned off by setting the global <code>$ui-corners-cache-buster</code> variable to false.</p>
{% gist 1161561 box.css %}
<p>One important thing to note is that the images are all measured using the <a href="http://compass-style.org/reference/compass/helpers/image-dimensions/">Compass image dimension functions</a>. Because all of list values other than <code>[background-image]</code> were left to auto, the corners were given a height and width equal to their respective background images. Similarly the sides were given values based on the images. For instance, the left side was given a <code>top</code> equal to the hight of the top-left image, a <code>bottom</code> equal to the hight of the bottom-left image and a width equal to the width of the top-left image. By default the sides are given the respective width or height of the nearest corner instead of the height width of their own image. This will help in cases where background colors also need to be applied to the sides to match the desired design.</p>
<figure>
	<iframe width="202" height="202" scrolling="no" frameborder="0" src="http://assets.heygrady.com/corners-2/box.html"></iframe>
	<figcaption>Mimicking <code>border-radius</code><br>(<a href="http://assets.heygrady.com/corners-2/box.html" target="_blank">view live example</a>)</figcaption>
</figure>
{% h2 Basic Sprite Example %}
<p>Of course include eight separate images just to mimic <code>border-radius</code> isn't most appealing thing in the world &mdash; <a href="http://css-tricks.com/158-css-sprites/">sprites are a good thing</a>. Currently the sprite needs to be produced beforehand and cannot be generated with <a href="http://compass-style.org/reference/compass/utilities/sprites/">Compass's excellent sprite functions</a>. The sprite image from the <a href="{% post_url 2011-02-24-cross-browser-rounded-corners-overview %}#background-images">previous article</a> will be used.</p>
{% gist 1161561 box-sprite.scss %}
<p>In the example above the same image is passed in for each of the corners and sides. For each corner a <code>width</code>, <code>height</code>, <code>background-position-x</code> and <code>background-position-y</code> are supplied. For the sides the respective <code>height</code> or <code>width</code> is specified as "auto" and then <code>background-position-x</code> and <code>background-position-y</code> are supplied. The above example will generate the CSS below.</p>
{% gist 1161561 box-sprite.css %}
<p>Similar to the basic example above, only the rules that differ from the basic.css are generated. When values are identical for groups of selectors they are appropriately grouped. For instance, the <code>background-image</code> is only specified once. Also of note, the <code>background-position</code> is no longer the default and is now in the CSS.</p>
<figure>
	<iframe width="202" height="202" scrolling="no" frameborder="0" src="http://assets.heygrady.com/corners-2/box-sprite.html"></iframe>
	<figcaption>Sprite Example<br>(<a href="http://assets.heygrady.com/corners-2/box-sprite.html" target="_blank">view live example</a>)</figcaption>
</figure>
<p>Using a sprite in this example will significantly reduce the file sizes. The eight images together total 4.4KB while the sprite image is only 1.1KB. Of course this also removes eight HTTP requests which is always a good thing &mdash; <a href="http://code.google.com/speed/page-speed/docs/rtt.html#SpriteImages">ask Google</a>.</p>
{% h2 Fancy Sprite Example %}
<p>Of course, this technique is not limited by simply mimicking <code>border-radius</code>. It's also possible to apply fancier borders that CSS could never do. For instance, imagine creating a box where nearly every Photoshop Layer Style has been applied &mdash; Drop Shadow, Inner Shadow, Outer Glow, Inner Glow, Bevel and Emboss and Color Overlay. It would be hard to mimick that without using images.</p>
<figure>
<img src="http://assets.heygrady.com/corners-2/i/box-fancy.png" alt="">
<figcaption>Super Fancy Border</figcaption>
</figure>
<figure>
<img src="http://assets.heygrady.com/corners-2/i/corner-fancy-sprite.png" alt="">
<figcaption>Super Fancy Sprite</figcaption>
</figure>
<figure>
<img src="http://assets.heygrady.com/corners-2/i/corner-fancy-sprite-sides.png" alt="">
<figcaption>Super Fancy Sides</figcaption>
</figure>
<p>Above is an image created using the list of Photoshop filters listed above. It has been turned into two different sprites. It's not possible to use a single sprite for all eight corners and sides when the sides are more that 1px solid colors. The top and bottom sides are repeated above and below the corners in the sprite.</p>
{% gist 1161561 box-fancy.scss %}
<p>In the above Sass, the positioning values are also used to move the shadow and glow outside the original box. For instance, the top-left corner is the first argument in <code>corner-images</code> and the first item in the list is the fancy sprite. The top left corner image is 18px by 18px and starts at 0px by 18px within the sprite. The first 8px of the corner are actually shadow as are the top 4px. The similar measurements are done for all of the corners and sides. The right and left sides get their own sprite because they didn't fit in the other one. This generates the CSS below.</p>
{% gist 1161561 box-fancy.css %}
<p>Below you can see the fancy sprite corners in a live example. It is important to note that the CSS will scale with the box as its content grows. The generated CSS would apply to any size box without any alterations.</p>
<figure>
	<iframe width="214" height="213" scrolling="no" frameborder="0" src="http://assets.heygrady.com/corners-2/box-fancy.html"></iframe>
	<figcaption>Fancy Example<br>(<a href="http://assets.heygrady.com/corners-2/box-fancy.html" target="_blank">view live example</a>)</figcaption>
</figure>
