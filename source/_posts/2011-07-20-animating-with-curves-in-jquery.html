---
layout: post
title: "Animating With Curves in jQuery"
date: 2011-07-20 11:48
comments: true
categories: 
---
<p>jQuery has a really strong animation library built in that makes it very easy to animate a CSS property with very little JavaScript. However, it's not well suited to animating complex things that are not directly related to CSS. In particular, tweening an element along a curve or animating a canvas &mdash; which doesn't use CSS &mdash; is more difficult.</p>
<p>To solve these issues I've created two new jQuery plugins: <a href="https://github.com/heygrady/curve">jQuery Tween and jQuery Curve</a>.</p>
<!--more-->
<h2>Tweening an object.</h2>
<p>Tween simply uses the existing jQuery animation functions to manage the animation frames but leaves the application of the animation to the user. This essentially means that instead of animiting a specific CSS property, tween simply fires a callback function. This is very similar to using the step callback option for jQuery animate but it removes some of the calculation overhead. Tween makes it easy to animate something like a canvas element which jQuery animate doesn'thandle by default.</p>
<p><iframe width="100%" height="300" frameborder="0" src="http://jsfiddle.net/heygrady/Rx5Wv/embedded/result%2Cjs/"></iframe></p>
<p>In the example above, a sine wave is drawn on a canvas over 3 seconds. The first argument in the tween plugin is a step function while all other aguments match the default jQuery animation function. The step function recieves 2 arguments, the current value and the fx object. The current value is always equal to the current time in tween while in a normal animation it is the current value of the css propery being animated. As the example above shows, the tween plugin makes it much easier to animate something besides a standard CSS property.</p>
<p>This is similar to animating a custom property with jQuery's built-in animate function. The example below shows the exact same behavior using the native jQuery animate with a custom property instead of using the tween function.</p>
<p><iframe width="100%" height="300" frameborder="0" src="http://jsfiddle.net/heygrady/jMe5K/embedded/result%2Cjs/"></iframe></p>
<p>While using animate directly is similar to tween, animate causes jQuery to perform a series of property lookups and calculations on initialization that are skipped with tween. Additionally, tween adds a special step function to the fx object that overrides jQuery's default bahvior to avoid any additional calculations on each step of the animation. It's also worth noting that animate calls the step function once for each property being animated. So if you're animating five properties (height, width, etc.) with the native jQuery animate functionality, the step function is called five times for each step of the animation.</p>
<h2>Using Curves</h2>
<p>The curve plugin contains a handful of useful functions for plotting curves as a function of time and work well with the tween plugin. The curves supported natively are circle, ellipse, sine, and bezier curves.&nbsp;It would be possible to define additional curves quite easily.&nbsp;Each function takes a similar set of options and returns x and y coordinates.</p>
<p><iframe width="100%" height="300" frameborder="0" src="http://jsfiddle.net/heygrady/eFDe5/embedded/result%2Cjs/"></iframe></p>
<p>The example above uses a curve function to draw a sine wave. The curve function actually returns 3 values in the array: x, y and the angle of the tangent line. The tangent angle can be used to rotate an object to follow the curve. As you can see, the curve function makes it easier to calculate a sine wave as a function of time.</p>
<h3>A curve as a function of time</h3>
<p>jQuery animate is using a simple concept of percentage of completion to perform animations. In a simple 1 second animation &mdash; let's animate the height property &mdash; jQuery will look at the current height value and the final height and calculate the difference. Next jQuery will calculate the current time and the duration &mdash; again, 1 second in this example &mdash; and start an interval timer. At each interval the percentage of the duration is calculated. That percentage is essentially the current time divided by the final time. The percentage is altered by the easing function to essentially speed up or slow down time before it is applied to the value in question.</p>
<p>Consider animating the height from 0px to 10px over 1 second. At 500ms the animation is 50% completed. In a step function the fx object reflects this as an fx.state of 0.5. The fx.pos is slightly different based on the easing function but with a default easing it is 0.4999. The current height is the start value plus the difference multiplied by the current position. This means 0px + 10px * 0.4999 which is 4.999px. Of course the differences between fx.state and fx.pos can be more dramatic over time. For instance, an fx.state of 0.25 corresponds to an fx.pos of 0.1464 using the default easing.</p>
<p>The value of fx.pos is essentially a percentage of completion and is important for plotting curves. Any curve, like a circle, has a start and an end point. Simple trginometry can be used to calculate any point on a circle at a certain time. This makes it trivial to use such a function for drawing a curves as the example below shows.</p>
<p><iframe width="100%" height="300" frameborder="0" src="http://jsfiddle.net/heygrady/X5fw4/embedded/result%2Cjs/"></iframe></p>
<p>The example above isn't animating the circle, it's drawing it as a series of line segments using a loop. The current position on the circle is calculated for each iteration of the loop. Even though it isn't animated, the circle is still drawn as a function of time. NOTE: if all you want to do is&nbsp;<a href="https://developer.mozilla.org/en/Canvas_tutorial/Drawing_shapes">draw a circle on a canvas</a> there's easier ways.</p>
<h3>Using the tangent angle</h3>
<p>In addition to the x and y coordinates, the curve functions can also return a tangent angle which can be used to rotate the element in order for it to follow the curve. The tangent is returned in radians. In the example below, the angle of the rocketship angle is set to the tangent angle so it will appear to follow the sine wave as it moves.</p>
<p><iframe width="100%" height="300" frameborder="0" src="http://jsfiddle.net/heygrady/BLMLu/embedded/result%2Cjs/"></iframe></p>
<p><iframe width="100%" height="310" frameborder="0" src="http://jsfiddle.net/heygrady/j5tHC/embedded/result%2Cjs/"></iframe></p>